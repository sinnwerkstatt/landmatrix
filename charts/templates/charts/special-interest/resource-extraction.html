{% extends "charts/special-interest/base.html" %}
{% load i18n static wagtailcore_tags %}

{% block chart %}
            <div class="resource_extraction chart hidden" id="resource_extraction">
                <div class="col-sm-12 text-center">
                    <h3>{% trans "Resource extraction:" %} <a class="toggle-tooltip bottom"
                                                              href="/about/#what-is-a-land-deal" data-original-title=""
                                                              title=""><i class="icon icon-question-sign"></i></a></h3>
                </div>
                <div class="col-sm-6 size">
                    <h4>{% trans "Size" %}</h4>
                    <p class="number number-concluded">0 ha</p>
                    <div class="progress progress-concluded">
                        <div class="bar" style="width: 0%;"></div>
                    </div>
                    <p class="percentage percentage-concluded">0%</p>
                    <p class="number number-intended">0 ha</p>
                    <div class="progress progress-intended">
                        <div class="bar" style="width: 0%;"></div>
                    </div>
                    <p class="percentage percentage-intended">0%</p>
                    <p class="number number-failed">0 ha</p>
                    <div class="progress progress-failed">
                        <div class="bar" style="width: 0%;"></div>
                    </div>
                    <p class="percentage percentage-failed">0%</p>
                </div>
                <div class="col-sm-6 deals">
                    <h4>{% trans "Number of deals" %}</h4>
                    <p class="number number-concluded">0</p>
                    <div class="progress progress-concluded">
                        <div class="bar" style="width: 0%;"></div>
                    </div>
                    <p class="percentage percentage-concluded">0%</p>
                    <p class="number number-intended">0</p>
                    <div class="progress progress-intended">
                        <div class="bar" style="width: 0%;"></div>
                    </div>
                    <p class="percentage percentage-intended">0%</p>
                    <p class="number number-failed">0</p>
                    <div class="progress progress-failed">
                        <div class="bar" style="width: 0%;"></div>
                    </div>
                    <p class="percentage percentage-failed">0%</p>
                </div>
            </div>
<script type="text/javascript">
function draw() {
                $.get('/api/statistics.json', function (data) {
                    var stats = $('#resource_extraction'),
                            size = stats.find('.size'),
                            deals = stats.find('.deals'),
                            by_deals = [0, 0, 0, 0],
                            by_size = [0, 0, 0, 0],
                            item;
                    for (var i = 0; i < data.length; i++) {
                        item = data[i];
                        // Update numbers
                        if (item[0].startsWith('Concluded')) {
                            by_deals[1] += item[1];
                            by_size[1] += item[2];
                        } else if (item[0].startsWith('Intended')) {
                            by_deals[2] += item[1];
                            by_size[2] += item[2];
                        } else if (item[0].startsWith('Failed')) {
                            by_deals[3] += item[1];
                            by_size[3] += item[2];
                        }
                        // Update totals
                        by_deals[0] += item[1];
                        by_size[0] += item[2];
                    }

                    // Update by size
                    size.find('.number-concluded').text(by_size[1] + ' ha');
                    percentage = parseInt(by_size[1] / by_size[0] * 100) + '%';
                    size.find('.progress-concluded .bar').css('width', percentage);
                    size.find('.percentage-concluded').text(percentage);
                    size.find('.number-intended').text(by_size[2] + ' ha');
                    percentage = parseInt(by_size[2] / by_size[0] * 100) + '%';
                    size.find('.progress-intended .bar').css('width', percentage);
                    size.find('.percentage-intended').text(percentage);
                    size.find('.number-failed').text(by_size[3] + ' ha');
                    percentage = parseInt(by_size[3] / by_size[0] * 100) + '%';
                    size.find('.progress-failed .bar').css('width', percentage);
                    size.find('.percentage-failed').text(percentage);

                    // Update by deals
                    deals.find('.number-concluded').text(by_deals[1]);
                    percentage = parseInt(by_deals[1] / by_deals[0] * 100) + '%';
                    deals.find('.progress-concluded .bar').css('width', percentage);
                    deals.find('.percentage-concluded').text(percentage);
                    deals.find('.number-intended').text(by_deals[2]);
                    percentage = parseInt(by_deals[2] / by_deals[0] * 100) + '%';
                    deals.find('.progress-intended .bar').css('width', percentage);
                    deals.find('.percentage-intended').text(percentage);
                    deals.find('.number-failed').text(by_deals[3]);
                    percentage = parseInt(by_deals[3] / by_deals[0] * 100) + '%';
                    deals.find('.progress-failed .bar').css('width', percentage);
                    deals.find('.percentage-failed').text(percentage);
                });

                $(".resource_extraction").removeClass('hidden');
};
</script>
{% endblock %}